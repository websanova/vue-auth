/*!
 * @websanova/vue-auth v3.3.8
 * https://websanova.com/docs/vue-auth
 * Released under the MIT License.
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],e):e(t.VueAuth={},t.vue)}(this,function(t,n){"use strict";function a(t){return null!==t&&"object"==typeof t&&t.constructor!==Array}function s(t){return"string"==typeof t||"number"==typeof t?[t]:t}function c(t,e){var r,n,o,i={};for(o in e=e||{},t)a(t[o])&&"FormData"!==t[o].constructor.name?i[o]=c(t[o],{}):i[o]=t[o];for(e.constructor!==Array&&(e=[e]),r=0,n=e.length;r<n;r++)for(o in e[r])a(e[r][o])&&"FormData"!==e[r][o].constructor.name?i[o]=c(t[o]||{},[e[r][o]]):i[o]=e[r][o];return i}function u(t,e){var r,n,o;if("[object Object]"===Object.prototype.toString.call(t)&&"[object Object]"===Object.prototype.toString.call(e)){for(o in t)if(u(t[o],e[o]))return!0;return!1}if(t=s(t),e=s(e),!t||!e||t.constructor!==Array||e.constructor!==Array)return!1;for(r=0,n=t.length;r<n;r++)if(0<=e.indexOf(t[r]))return!0;return!1}function o(t,e,r){var n,o=t+"="+e+";";for(n in r)!1!==r[n]&&void 0!==r[n]&&(null===r[n]?this.options["getCookie"+n]&&(o+=" "+n+"="+this.options["getCookie"+n]()+";"):!0===r[n]?o+=" "+n+";":o+=" "+n+"="+r[n]+";");document.cookie=o}function i(t){return"string"!=typeof t&&null!=t?new Date((new Date).getTime()+t).toUTCString():t}function e(t){var e=Object.assign({},this.options.cookie);e.Expires=i(-12096e5),o.call(this,t,"",e)}var l=Object.freeze({get:function(t){for(var e=document.cookie,r=0,n=(e=e.replace(/;\s+/g,";").split(";").map(function(t){return t.replace(/\s+=\s+/g,"=").split("=")})).length;r<n;r++)if(e[r][0]&&e[r][0]===t)return e[r][1];return null},set:function(t,e,r){var n=this.options.cookie;n.Expires=!0===r?"":i(n.Expires),o.call(this,t,e,n)},remove:e});var p=Object.freeze({get:function(t){return sessionStorage.getItem(t)||localStorage.getItem(t)},set:function(t,e,r){r?sessionStorage.setItem(t,e):localStorage.setItem(t,e)},remove:function(t){localStorage.removeItem(t),sessionStorage.removeItem(t)}});function d(t,e,r,n){var o=0,i=this.options.stores,a=i.length,s=[function(t){return(t=t||this.currentToken)||(this.impersonating()?this.options.tokenImpersonateKey:this.options.tokenDefaultKey)}.call(this,e)];for("set"===t&&(s.push(r),s.push(!0===n));o<a;o++){if("storage"===i[o]&&function(){try{if(!window.localStorage)throw"exception";return localStorage.setItem("storage_test",1),localStorage.removeItem("storage_test"),1}catch(t){return}}()&&function(){try{if(!window.sessionStorage)throw"exception";return sessionStorage.setItem("storage_test",1),sessionStorage.removeItem("storage_test"),1}catch(t){return}}())return p[t].apply(this,s);if("cookie"===i[o])return l[t].apply(this,s)}}function f(t){return d.call(this,"get",t)}function h(t,e,r){return d.call(this,"set",t,e,r)}function m(t){return d.call(this,"remove",t)}var v=null,y={rolesKey:"roles",rememberKey:"auth_remember",staySignedInKey:"auth_stay_signed_in",tokenDefaultKey:"auth_token_default",tokenImpersonateKey:"auth_token_impersonate",stores:["storage","cookie"],cookie:{Path:"/",Domain:null,Secure:!0,Expires:12096e5,SameSite:"None"},authRedirect:{path:"/login"},forbiddenRedirect:{path:"/403"},notFoundRedirect:{path:"/404"},registerData:{url:"auth/register",method:"POST",redirect:"/login",autoLogin:!1},loginData:{url:"auth/login",method:"POST",redirect:"/",fetchUser:!0,staySignedIn:!0},logoutData:{url:"auth/logout",method:"POST",redirect:"/",makeRequest:!1},fetchData:{url:"auth/user",method:"GET",enabled:!0},refreshData:{url:"auth/refresh",method:"GET",enabled:!0,interval:30},impersonateData:{url:"auth/impersonate",method:"POST",redirect:"/",fetchUser:!0},unimpersonateData:{url:"auth/unimpersonate",method:"POST",redirect:"/admin",fetchUser:!0,makeRequest:!1},oauth2Data:{url:"auth/social",method:"POST",redirect:"/",fetchUser:!0},getUrl:k,getCookieDomain:function(){return window.location.hostname},parseUserData:function(t){return t.data||{}}};function r(t,e){return!0===v.$vm.authenticated&&(!t||u(t,function(t,e){var r=e.split(".");for(0;r.length;)t=t[r.shift()];return t}(v.$vm.data||{},e||v.options.rolesKey)))}function g(){return!f.call(v)}function b(t){var e,r;return t.to?e=t.to.auth:(r=t.matched.filter(function(t){return Object.prototype.hasOwnProperty.call(t.meta,"auth")})).length&&(e=r[r.length-1].meta.auth),e}function k(){var t=window.location.port;return window.location.protocol+"//"+window.location.hostname+(t?":"+t:"")}function D(t){v.$vm.loaded=!0,v.$vm.authenticated=t}function S(t){t?(h.call(v,v.options.rememberKey,t,!1),v.$vm.remember=t):(m.call(v,v.options.rememberKey),v.$vm.remember=null)}function I(t){v.transitionPrev=v.transitionThis,v.transitionThis=t}function T(t){return v.options.parseUserData(v.drivers.http.httpData(t))}function w(t){var e,r;return t&&t.ignoreVueAuth||(!1===t.impersonating&&v.impersonating()&&(r=v.options.tokenDefaultKey),(e=f.call(v,r))&&v.drivers.auth.request.call(v,t,e)),t}function $(t,e){var r;e&&e.ignoreVueAuth||(function(t,e){var r,n,o="",i=e&&e.path;if(i&&e.query){for(r in e.query)e.query[r]&&(o+="&"+r+"="+e.query[r]);i+="?"+o.substring(1)}if(!v.drivers.http.invalidToken||!v.drivers.http.invalidToken.call(v,t))return;e&&(n=b(e));n&&(i=n.redirect||v.options.authRedirect);_({redirect:i})}(t,v.transitionThis),(r=v.drivers.auth.response.call(v,t))&&h.call(v,null,r,!f.call(v,v.options.staySignedInKey)))}function K(t){var e=g();e&&v.$vm.authenticated&&_(),e||v.$vm.loaded||!v.options.refreshData.enabled?R(t):v.refresh().then(function(){R(t)})}function R(t){return null===v.$vm.authenticated&&f.call(v)?v.options.fetchData.enabled?void v.fetch().then(t,t):(O({}),t.call(v)):(v.$vm.loaded=!0,t.call(v))}function P(t,e,r){var n=(e||"").redirect||v.options.authRedirect,o=(e||"").forbiddenRedirect||(e||"").redirect||v.options.forbiddenRedirect,i=(e||"").notFoundRedirect||(e||"").redirect||v.options.notFoundRedirect;if((e=s(void 0!==(e||"").roles?e.roles:e))&&(!0===e||e.constructor===Array||a(e)))if(v.check()){if(e.constructor!==Array&&!a(e)||u(e,v.$vm.data[v.options.rolesKey]))return v.$vm.redirect=v.transitionRedirectType?{type:v.transitionRedirectType,from:v.transitionPrev,to:v.transitionThis}:null,v.transitionRedirectType=null,r();v.transitionRedirectType=403,"function"==typeof o&&(o=o(t)),r.call(v,o)}else v.transitionRedirectType=401,"function"==typeof n&&(n=n(t)),r.call(v,n);else{if(!1!==e||!v.check())return v.$vm.redirect=v.transitionRedirectType?{type:v.transitionRedirectType,from:v.transitionPrev,to:v.transitionThis}:null,v.transitionRedirectType=null,r();v.transitionRedirectType=404,"function"==typeof i&&(i=i(t)),r.call(v,i)}}function O(t,e){var r;r=t,v.$vm.data=r,D(!0),U(e)}function _(t){e.call(v,v.options.tokenImpersonateKey),e.call(v,v.options.tokenDefaultKey),m.call(v,v.options.tokenImpersonateKey),m.call(v,v.options.tokenDefaultKey),m.call(v,v.options.staySignedInKey),v.$vm.loaded=!0,v.$vm.authenticated=!1,v.$vm.data=null,U(t)}function U(t){t&&v.drivers.router.routerGo.call(v,t)}function j(t,e){var r;e=e||{},(v=this).plugins=e.plugins,this.drivers=e.drivers,this.options=c(y,e.options),delete e.plugins,delete e.drivers,delete e.options,this.currentToken=null,this.transitionPrev=null,this.transitionThis=null,this.transitionRedirectType=null,function(){for(var t=["auth","http","router"],e=0,r=t.length;e<r;e++){if(!v.drivers[t[e]])return console.error('Error (@websanova/vue-auth): "'+t[e]+'" driver must be set.');if(v.drivers[t[e]]._init&&(msg=v.drivers[t[e]]._init.call(v),msg))return console.error("Error (@websanova/vue-auth): "+msg)}}(),r=t,v.$vm=new r({data:function(){return{data:null,loaded:!1,redirect:null,authenticated:null,impersonating:void 0,remember:void 0}}}),v.options.refreshData.enabled&&0<v.options.refreshData.interval&&setInterval(function(){v.options.refreshData.enabled&&!g()&&v.refresh()},1e3*v.options.refreshData.interval*60),v.drivers.http.interceptor.call(v,w,$),v.drivers.router.beforeEach.call(v,K,P,I,b)}function x(t){var e,r=t.data();for(e in r)this[e]=n.reactive(Object.assign({},r[e]))}j.prototype.ready=function(){return v.$vm.loaded},j.prototype.load=function(){return new Promise(function(t){var e=null,e=setInterval(function(){v.$vm.loaded&&(clearInterval(e),t())},50)})},j.prototype.redirect=function(){return v.$vm.redirect},j.prototype.user=function(t){return void 0!==t&&O(t),v.$vm.data},j.prototype.check=r,j.prototype.impersonating=function(){var t=!!f.call(v,v.options.tokenImpersonateKey);return void 0===v.$vm.impersonating&&(v.$vm.impersonating=t),v.$vm.impersonating},j.prototype.token=function(t,e,r){return void 0!==e&&(null===e?m.call(v,t):(r=!0===r||!1===r?r:!f.call(v,v.options.staySignedInKey),h.call(v,t,e,r))),f.call(v,t)},j.prototype.fetch=function(r){return r=c(v.options.fetchData,r),new Promise(function(e,t){v.drivers.http.http.call(v,r).then(function(t){O(T(t),r.redirect),e(t)},t)})},j.prototype.refresh=function(t){return t=c(v.options.refreshData,t),v.drivers.http.http.call(v,t)},j.prototype.register=function(o){var i=c(v.options.registerData,o);return new Promise(function(r,n){v.drivers.http.http.call(v,i).then(function(t){var e;i.autoLogin?(e=c(v.options.loginData,o),v.login(e).then(r,n)):(r(t),U(i.redirect))},n)})},j.prototype.login=function(n){return S((n=c(v.options.loginData,n)).remember),!0===n.staySignedIn?h.call(v,v.options.staySignedInKey,"true",!1):m.call(v,v.options.staySignedInKey),new Promise(function(e,r){v.drivers.http.http.call(v,n).then(function(t){n.fetchUser||void 0===n.fetchUser&&v.options.fetchData.enabled?v.fetch({redirect:n.redirect}).then(e,r):(O(T(t),n.redirect),e(t))},function(t){D(!1),r(t)})})},j.prototype.remember=function(t){t&&S(t);var e=f.call(v,v.options.rememberKey);return void 0===v.$vm.remember&&(v.$vm.remember=e),v.$vm.remember},j.prototype.unremember=function(){S(null)},j.prototype.logout=function(r){return r=c(v.options.logoutData,r),new Promise(function(e,t){r.makeRequest?v.drivers.http.http.call(v,r).then(function(t){_(r.redirect),e(t)},t):(_(r.redirect),e())})},j.prototype.impersonate=function(a){return a=c(v.options.impersonateData,a),new Promise(function(n,o){var i=v.token();v.drivers.http.http.call(v,a).then(function(t){var e,r;e=i,h.call(v,v.options.tokenImpersonateKey,v.token(),!f.call(v,v.options.staySignedInKey)),h.call(v,v.options.tokenDefaultKey,e,!f.call(v,v.options.staySignedInKey)),v.$vm.impersonating=!0,U(r),a.fetchUser||void 0===a.fetchUser&&v.options.fetchData.enabled?v.fetch({redirect:a.redirect}).then(n,o):(U(a.redirect),n(t))},o)})},j.prototype.unimpersonate=function(r){return r=c(v.options.unimpersonateData,r),new Promise(function(t,e){r.makeRequest?v.drivers.http.http.call(v,r).then(t,e):t()}).then(function(){return new Promise(function(t,e){m.call(v,v.options.tokenImpersonateKey),v.$vm.impersonating=!1,U(void 0),r.fetchUser||void 0===r.fetchUser&&v.options.fetchData.enabled?v.fetch({redirect:r.redirect}).then(t,e):(U(r.redirect),t())})})},j.prototype.oauth2=function(t,e){var r,n,o="";if(e.code){try{e.state&&(e.state=JSON.parse(decodeURIComponent(e.state)))}catch(t){console.error("vue-auth:error There was an issue retrieving the state data."),e.state=e.state||{}}return delete(e=c(v.options.oauth2Data,[e.state,e])).code,delete e.state,delete e.params,v.login(e)}for(r in(e=c(v.drivers.oauth2[t],e)).params.state=JSON.stringify(e.params.state||{}),e.params.redirect_uri=(n=e.params.redirect_uri,/^https?:\/\//.test(n=n||"")?n:k()+"/"+n.replace(/^\/|\/$/g,"")),e.params)o+="&"+r+"="+encodeURIComponent(e.params[r]);window.location=e.url+"?"+o.substring()},j.prototype.enableImpersonate=function(){v.impersonating()&&(v.currentToken=null)},j.prototype.disableImpersonate=function(){v.impersonating()&&(v.currentToken=v.options.tokenDefaultKey)},x.set=function(t,e,r){t[e]=n.reactive(r)},j.prototype.install=function(t){this.Vue=x,(this.ctx=t).auth=this,t.config.globalProperties.$auth=this},t.createAuth=function(t){return new j(x,t)},Object.defineProperty(t,"__esModule",{value:!0})});